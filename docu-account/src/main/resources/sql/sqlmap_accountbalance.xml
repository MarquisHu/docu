<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.docu.account.dao.AccountBalanceDao">
    
    <resultMap id="BALANCE_RESULT_MAP" type="AccountBalance">
        <result property="userId" column="USER_ID" />
        <result property="accountId" column="ACCOUNT_ID" />
        <result property="userName" column="USER_NAME" />
		<result property="balance" column="BALANCE_AMOUNT" />
		<result property="updateTime" column="UPDATE_TIME" />
	</resultMap>

	<sql id="BALANCE_DO_QUERY_COLUMNS">
	    A1.USER_ID 					userId, 
	    A2.ACCOUNT_ID				accountId,
		A1.USER_NAME		 			userName, 
		A2.BALANCE_AMOUNT 			balance,
		date_format(A2.UPDATE_TIME, '%Y-%m-%d %h:%i:%s') updateTime
	</sql>
	
	<select id="queryAccountBalanceTotal" parameterType="com.docu.components.common.QueryBase" resultType="int">
	    SELECT
		COUNT(*)
		<![CDATA[  
	     	FROM DOCU_ERP_USER A1, DOCU_ERP_ACCOUNT A2
	    ]]>
	    <where>
	         <![CDATA[
		    		A1.USER_ID = A2.USER_ID
		    ]]>
	        <if test="entity.userId != null">
			    <![CDATA[
			    	AND A1.USER_ID = #{entity.userId,jdbcType=VARCHAR}
				]]>
			</if>
	        <if test="entity.accountId != null">
			    <![CDATA[
			    	AND A2.ACCOUNT_ID = #{entity.accountId,jdbcType=VARCHAR}
				]]>
			</if>
			<if test="entity.userName != null">
			    <![CDATA[
			    	AND A1.USER_NAME = #{entity.userName,jdbcType=VARCHAR}
				]]>
			</if>
			<if test="entity.balance != null">
			    <![CDATA[
			    	AND A2.BALANCE_AMOUNT = #{entity.balance,jdbcType=FLOAT}
				]]>
			</if>
		</where>
	</select>
	
	<select id="queryAccountBalance" parameterType="com.docu.components.common.QueryBase" resultMap="BALANCE_RESULT_MAP">
	    SELECT
		<include refid="BALANCE_DO_QUERY_COLUMNS" />
		<![CDATA[  
	     	FROM DOCU_ERP_USER A1, DOCU_ERP_ACCOUNT A2
	    ]]>
	    <where>
	        <![CDATA[
		    		A1.USER_ID = A2.USER_ID
		    ]]>
	        <if test="entity.userId != null">
			    <![CDATA[
			    	AND A1.USER_ID = #{entity.userId,jdbcType=VARCHAR}
				]]>
			</if>
	        <if test="entity.accountId != null">
			    <![CDATA[
			    	AND A2.ACCOUNT_ID = #{entity.accountId,jdbcType=VARCHAR}
				]]>
			</if>
			<if test="entity.userName != null">
			    <![CDATA[
			    	AND A1.USER_NAME = #{entity.userName,jdbcType=VARCHAR}
				]]>
			</if>
			<if test="entity.balance != null">
			    <![CDATA[
			    	AND A2.BALANCE_AMOUNT = #{entity.balance,jdbcType=FLOAT}
				]]>
			</if>
		</where>
		ORDER BY A2.ACCOUNT_ID, A1.USER_ID 
		LIMIT #{preEndNum}, #{pageSize}
	</select>
</mapper>